<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- ... (metadatos y estilos iguales) ... -->
  </head>
  <body>
    <div id="loading">Iniciando AR, por favor espera...</div>
    
    <a-scene
      mindar-image="imageTargetSrc: ./target.mind; filterMinCF: 0.0001; filterBeta: 0.01; warmupTolerance: 5; missTolerance: 5;"
      color-space="sRGB"
      embedded
      renderer="colorManagement: true; precision: high; antialias: true; alpha: true;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <!-- ... (assets y entidades iguales) ... -->
      
      <!-- Cámara con componentes interactivos mejorados -->
      <a-camera 
        position="0 0 0" 
        cursor="rayOrigin: mouse" 
        raycaster="objects: .clickable; far: 5;"
        mouse-cursor
      ></a-camera>
    </a-scene>

    <!-- ... (enlace oculto igual) ... -->

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        const loading = document.getElementById('loading');
        let arStarted = false;

        // 1. Mejorar inicialización de AR
        scene.addEventListener('mindar-system-ready', function() {
          console.log("Sistema AR listo");
          scene.systems['mindar-image-system'].start();
        });

        // 2. Detectar cuando el target es reconocido
        scene.addEventListener('targetFound', event => {
          console.log("Target detectado");
          if (!arStarted) {
            loading.style.display = 'none';
            arStarted = true;
          }
        });

        // 3. Manejar errores específicos
        scene.addEventListener('error', function(error) {
          console.error("Error general:", error.detail);
          loading.innerHTML = "Error al cargar AR. Recarga la página.";
        });

        // 4. Timeout de seguridad
        setTimeout(() => {
          if (!arStarted) {
            console.warn("Inicio automático por timeout");
            loading.style.display = 'none';
            if (scene.systems['mindar-image-system']) {
              scene.systems['mindar-image-system'].start();
            }
          }
        }, 5000); // 5 segundos

        // 5. Configurar interacción del botón
        scene.addEventListener('loaded', function() {
          const visitButton = document.querySelector('#visitButton');
          
          // Feedback táctil
          visitButton.addEventListener('mousedown', () => {
            visitButton.setAttribute('color', '#0044cc');
          });
          
          visitButton.addEventListener('mouseup', () => {
            visitButton.setAttribute('color', '#0066ff');
            document.getElementById("hiddenLink").click();
          });

          // Para dispositivos táctiles
          visitButton.addEventListener('touchstart', () => {
            visitButton.setAttribute('color', '#0044cc');
          });
          
          visitButton.addEventListener('touchend', () => {
            visitButton.setAttribute('color', '#0066ff');
            document.getElementById("hiddenLink").click();
          });
        });
      });
    </script>
  </body>
</html>

