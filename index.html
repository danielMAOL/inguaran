<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paletería Nevería AR</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #instructions {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 0;
            z-index: 10;
        }
    </style>
    <!-- Carga de las librerías necesarias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mind-ar/1.2.0/mindar-image.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mind-ar/1.2.0/mindar-image-three.prod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r132/three.min.js"></script>
</head>
<body>
    <div id="loading">Cargando, por favor espera...</div>
    <div id="instructions">Apunta la cámara hacia el marcador</div>

    <script>
        const start = async () => {
            // Ocultar mensaje de carga cuando todo esté listo
            const loading = document.getElementById('loading');
            const instructions = document.getElementById('instructions');

            // Inicializar MindAR
            const mindarThree = new MindARThree({
                container: document.body,
                imageTargetSrc: './assets/paleterianeveria.mind',
            });
            
            const { renderer, scene, camera } = mindarThree;

            // Crear anchor (punto de anclaje) para el target
            const anchor = mindarThree.addAnchor(0);

            // Crear texto 3D
            const fontLoader = new THREE.FontLoader();
            
            fontLoader.load('https://cdnjs.cloudflare.com/ajax/libs/three.js/r132/fonts/helvetiker_bold.typeface.json', function(font) {
                const textGeo = new THREE.TextGeometry('desde 1950\ncreando dulces historias', {
                    font: font,
                    size: 0.1,
                    height: 0.02,
                    curveSegments: 4,
                    bevelEnabled: true,
                    bevelThickness: 0.01,
                    bevelSize: 0.005
                });
                
                // Centrar el texto
                textGeo.computeBoundingBox();
                const centerOffset = -0.5 * (textGeo.boundingBox.max.x - textGeo.boundingBox.min.x);
                
                // Material para el texto
                const material = new THREE.MeshStandardMaterial({
                    color: 0xFF5500,
                    metalness: 0.3,
                    roughness: 0.4
                });
                
                const textMesh = new THREE.Mesh(textGeo, material);
                textMesh.position.x = centerOffset;
                textMesh.position.y = 0;
                textMesh.position.z = 0;
                
                // Añadir luces
                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(0, 0, 1);
                scene.add(light);
                
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                scene.add(ambientLight);
                
                // Añadir el texto al anchor
                anchor.group.add(textMesh);
                
                // Eventos del target
                anchor.onTargetFound = () => {
                    console.log("Target encontrado");
                    instructions.style.display = "none";
                };
                
                anchor.onTargetLost = () => {
                    console.log("Target perdido");
                    instructions.style.display = "block";
                };
                
                // Ocultar pantalla de carga
                loading.style.display = "none";
            });
            
            // Iniciar experiencia AR
            await mindarThree.start();
            
            // Loop de renderizado
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        };
        
        window.addEventListener('DOMContentLoaded', () => {
            start();
        });
    </script>
</body>
</html>
